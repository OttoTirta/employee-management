@if (isOpen) {
  <div class="fixed inset-0 z-[60] bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
  <div class="fixed inset-0 z-[70] flex items-center justify-center p-4">
    <div class="relative glass-panel w-full max-w-2xl transform transition-all rounded-2xl overflow-hidden animate-[scaleIn_0.2s_ease-out]"
          role="dialog" aria-modal="true">
      
      <div class="flex items-center justify-between p-6 border-b border-white/10">
        <h3 class="text-xl font-bold text-white">
          {{isCreate ? 'Create New Employee' : 'Edit Employee'}}
        </h3>
        <button (click)="closeForm()" type="button" class="text-slate-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 rounded-lg p-2">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
      </div>
  
      <div class="p-6 max-h-[70vh] overflow-y-auto custom-scrollbar">
        <form #employeeForm="ngForm" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          @if (errorMessage) {
            <div class="sm:col-span-2 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-200 text-sm text-center">
              {{errorMessage}}
            </div>
          }
          <div>
            <label for="firstName" class="form-label text-slate-300 text-sm font-semibold mb-2 block">First Name</label>
            <input type="text" id="firstName" name="firstName" [(ngModel)]="employeeData.firstName" #firstNameInput="ngModel" required class="custom-input">
            @if (firstNameInput.invalid && (firstNameInput.dirty || firstNameInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (firstNameInput.errors?.['required']) {
                  <span>First Name is required.</span>
                }
              </div>
            }
          </div>
          <div>
            <label for="lastName" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Last Name</label>
            <input type="text" id="lastName" name="lastName" [(ngModel)]="employeeData.lastName" #lastNameInput="ngModel" required class="custom-input">
            @if (lastNameInput.invalid && (lastNameInput.dirty || lastNameInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (lastNameInput.errors?.['required']) {
                  <span>Last Name is required.</span>
                }
              </div>
            }
          </div>
          <div class="sm:col-span-2">
            <label for="username" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Username</label>
            <input type="text" id="username" name="username" [(ngModel)]="employeeData.username" #usernameInput="ngModel" required class="custom-input">
            @if (usernameInput.invalid && (usernameInput.dirty || usernameInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (usernameInput.errors?.['required']) {
                  <span>Username is required.</span>
                }
              </div>
            }
          </div>
          <div class="sm:col-span-2">
            <label for="email" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Email</label>
            <input type="email" id="email" name="email" [(ngModel)]="employeeData.email" #emailInput="ngModel" required email class="custom-input">
            @if (emailInput.invalid && (emailInput.dirty || emailInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (emailInput.errors?.['required']) {
                  <span>Email is required.</span>
                }
                @else if (emailInput.errors?.['email']) {
                  <span>Please enter a valid email format.</span>
                }
              </div>
            }
          </div>
          <div class="sm:col-span-2">
            <label for="birthDate" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Birth Date</label>
            <input type="date" onkeydown="return false"  [max]="today" id="birthDate" name="birthDate" [(ngModel)]="birthDateValue" #birthDateInput="ngModel" required class="custom-input [color-scheme:dark]">
            @if (birthDateInput.invalid && (birthDateInput.dirty || birthDateInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (birthDateInput.errors?.['required']) {
                  <span>BirthDate is required.</span>
                }
                @else if (birthDateInput.errors?.['max']) {
                  <span>Birthdate cannot be in the future.</span>
                }
              </div>
            }
          </div>
          <div>
              <label for="basicSalary" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Basic Salary (IDR)</label>
              <input type="number" id="basicSalary" name="basicSalary" [(ngModel)]="employeeData.basicSalary" #basicSalaryInput="ngModel" required class="custom-input">
            @if (basicSalaryInput.invalid && (basicSalaryInput.dirty || basicSalaryInput.touched)) {
              <div class="text-red-400 text-xs mt-1 ml-1">
                @if (basicSalaryInput.errors?.['required']) {
                  <span>Basic Salary is required.</span>
                }
              </div>
            }
          </div>
          <div>
            <label for="group" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Group</label>
            <select id="group" name="group" required [(ngModel)]="employeeData.group" class="custom-input appearance-none">
              @for (group of availableGroups; track $index) {
                <option [value]="group" class="bg-gray-800">{{group}}</option>
              }
            </select>
          </div>
          <div class="sm:col-span-2">
            <label for="status" class="form-label text-slate-300 text-sm font-semibold mb-2 block">Status</label>
            <select id="status" name="status" [(ngModel)]="employeeData.status" required class="custom-input appearance-none">
              @for (status of statusList; track $index) {
                <option [value]="status" class="bg-gray-800">{{status}}</option>
              }
            </select>
          </div>
        </form>
      </div>
  
      <div class="flex items-center justify-end p-6 space-x-3 border-t border-white/10 bg-white/5">
        <button (click)="closeForm()" type="button" class="px-5 py-2.5 rounded-xl text-slate-300 font-medium hover:text-white hover:bg-white/10 transition-colors">
          Cancel
        </button>
        <button
          (click)="saveEmployee()" 
          [disabled]="employeeForm.invalid"
          type="button" 
          class="px-5 py-2.5 rounded-xl font-bold text-white bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-400 hover:to-blue-500 shadow-lg shadow-sky-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform active:scale-95"
        >
          {{isCreate ? 'Create Employee' : 'Save Changes'}}
        </button>
      </div>
  
    </div>
  </div>
}